---
name: running-app-skill
description: ランニングアプリの開発とメンテナンスに関するスキル
---

# ランニングアプリ・アシスタント

このスキルは、ランニングアプリのコード作成、デバッグ、および機能改善を支援するためのガイドラインを提供します。

## プロジェクト構成
```
ランニングアプリ/
├── index.html    # メインHTML、各種モーダル含む
├── app.js        # 全てのロジック（GPS、記録、履歴、天気など）
├── style.css     # スタイル定義
├── sw.js         # Service Worker（PWAオフライン対応）
└── manifest.json # PWAマニフェスト
```

## 開発の原則
- **モバイルファースト**: 屋外での使用を想定し、モバイルフレンドリーなUI/UXを最優先する
- **オフライン対応**: PWAとしての機能を維持し、電波の悪い場所でも動作するようにする
- **データの永続化**: `localStorage` を使用したデータの保存
- **コード品質**: バニラJavaScript/CSSを使用し、シンプルでメンテナブルなコードを維持

## 実装済み機能と注意点

### GPS機能
- **位置情報取得**: `navigator.geolocation.watchPosition()` で継続追跡
- **経路表示**: Leaflet.jsを使用したマップ上での経路可視化（モーダル内表示）
- **経路データ保存**: 記録と共に座標配列を `localStorage` に保存

### 天気記録
- **Open-Meteo API**: GPS座標から現在の天気・気温を自動取得
- **手動入力**: APIが利用不可の場合の手動選択も可能
- **データ保存**: 各ランニング記録に天気情報を付加

### 音声ガイド
- **カスタマイズ**: 設定ボタン（⚙️）から声の種類、ピッチ（高さ）、速度を調整可能
- **アニメ風音声**: ピッチ（Pitch）を「2.0」に近い値に設定すると、高音で可愛いアニメ風の音声になる
- **永続化**: 設定値は `localStorage` に保存され、次回の起動時にも反映される

### 目標管理
- **月間目標**: プログレスバーで達成度を可視化
- **達成演出**: confetti（紙吹雪）アニメーションで演出
- **設定モーダル**: 目標距離の設定・編集UI

### ハンバーガーメニュー
- **z-index問題**: メニューボタンがクリックできない場合は `z-index` を確認
- **タッチ領域**: モバイルでは十分な大きさ（44px以上）を確保
- **イベント伝播**: 必要に応じて `stopPropagation()` を使用

## 実装上の重要なルール
1. **カスタムモーダル**: `confirm()` などのブラウザ標準ダイアログは避け、`showCustomConfirm` 等を使用
2. **自動更新（PWA）**: 
   - 新しいバージョンが検知されると、自動的に `skipWaiting` が実行され、ページがリロード（最新版適用）される
   - 機能追加時（`sw.js` の `CACHE_NAME` 更新時）は、ユーザーのスマホでも自動で再起動がかかることを意識する
3. **Service Worker更新**: 機能追加後は `sw.js` のキャッシュバージョンを更新
4. **バージョン表示**: サイドメニュー内にアプリバージョン（例: v1.1.0）を表示

## よくある問題と解決策
| 問題 | 原因 | 解決策 |
|------|------|--------|
| メニューがクリックできない | z-indexが他要素より低い | メニューの `z-index` を高く設定 |
| GPSが動作しない | 権限未許可/HTTPS未使用 | 権限リクエスト確認、HTTPSで配信 |
| オフラインで動作しない | Service Workerのキャッシュ漏れ | `sw.js` のキャッシュリストを確認 |

## Git運用
- リポジトリ: `kazukiqq/run-log`
- 変更後は適宜コミット＆プッシュ
